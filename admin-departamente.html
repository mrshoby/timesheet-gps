<!DOCTYPE html>

<html lang="ro">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>SERVELECT â€¢ Admin Pontaj</title>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="favicon.png" rel="icon"/>
<meta content="#516A75" name="theme-color"/>
<link href="admin-core.css" rel="stylesheet"/><link href="admin-embed.css" rel="stylesheet"/></head>
<body class="admin-embed view-dept" data-page-title="Departamente &amp; Ultimele pontaje â€¢ Admin">
<div class="shell">
<nav class="nav card">
<a aria-label="Spre pontaj" class="brand" href="index.html">
<img alt="SiglÄƒ SERVELECT" src="favicon.png"/>
<div>
<h1><span>SERVELECT</span><small>Pontaj &amp; Management Concedii</small></h1>
</div>
</a>
<div class="nav-actions">
<!-- Ãnapoi la pontaj -->
<a class="btn" href="index.html" id="backToTimesheetLink">
      â† Ãnapoi la pontaj
    </a>
<!-- Badge de context -->
<div class="chip">Admin dashboard</div>
<!-- Meniu hamburger (user + Deconectare) -->
<div class="nav-menu-wrapper">
<button aria-expanded="false" aria-label="Meniu admin" class="hamburger-btn" id="adminHamburgerBtn" type="button">
<span class="hamburger-box">
<span class="hamburger-inner"></span>
</span>
</button>
<div class="nav-menu" id="adminHamburgerMenu">
<div class="nav-menu-section">
<div class="nav-menu-user-label">Utilizator logat</div>
<div class="chip" id="adminLabel">Admin</div>
</div>
<div class="nav-menu-section nav-menu-actions">
<button class="nav-menu-item nav-menu-item-danger" id="logoutBtn" type="button">
<span>Deconectare</span>
</button>
</div>
</div>
</div>
<!-- Self-service: lÄƒsat Ã®n DOM pentru script, dar ascuns prin CSS -->
<a class="btn" href="self.html" id="selfServiceLink" rel="noopener" target="_blank">
      ğŸ§¾ Self-service â€“ raportul meu
    </a>
</div>
</nav>
<main class="admin-layout">
<section class="admin-main">
<header class="admin-header">
<h1>Departamente &amp; ultimele pontaje</h1>
<!-- ACÈšIUNI HEADER: status + reset filtre + refresh -->
<div class="admin-header-actions">
<span class="nav-status" id="lastUpdate"></span>
<!-- Reset filtre (icon â€filter resetâ€) -->
<button class="nav-icon-btn" id="resetFiltersBtn" title="Reset: perioadÄƒ=astÄƒzi, dept=toate, angajat=toÈ›i, zi=null, incomplete=off" type="button">
<span aria-hidden="true" class="nav-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8">
<!-- coadÄƒ mÄƒturÄƒ -->
<path d="M5 3l11 11"></path>
<path d="M14 6l4 4"></path>
<!-- perie -->
<path d="M11 14l-4 4"></path>
<path d="M7 18c2-2 6-2 8 0"></path>
<path d="M6 19c2-2 8-2 10 0"></path>
<path d="M5 20c2-2 10-2 12 0"></path>
</g>
</svg>
</span>
</button>
<!-- Refresh (icon â€circular arrowsâ€) -->
<button class="nav-icon-btn" id="adminRefreshBtn" title="ReÃ®ncarcÄƒ datele din server" type="button">
<span aria-hidden="true" class="nav-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8">
<path d="M7 2h10"></path>
<path d="M7 22h10"></path>
<path d="M7 2c0 6 5 6 5 10s-5 4-5 10"></path>
<path d="M17 2c0 6-5 6-5 10s5 4 5 10"></path>
<path d="M10 12h4"></path>
</g>
</svg>
</span>
</button>
</div>
<div class="admin-filter-line">
<div class="admin-filter-summary">
<div class="filter-chips" id="filterChips"></div>
</div>
<label>
<span>PerioadÄƒ</span>
<select id="rangeSelect">
<option value="today">AstÄƒzi</option>
<option value="last7">Ultimele 7 zile</option>
<option value="all">Toate datele</option>
</select>
</label>
<label class="label-dept">
<span>Departament</span>
<div class="dept-filter-row">
<select id="deptFilter">
<option value="all">Toate</option>
</select>
<!-- toggle incomplete -> buton verde/galben -->
<button class="incomplete-btn" id="incompleteToggleBtn" title="ComutÄƒ Ã®ntre toate zilele È™i doar zilele incomplete (START / PAUSE / EXTRA deschise)" type="button">
                  âš  Incomplete
                </button>
</div>
</label>
<label>
<span>Angajat</span>
<select id="employeeFilter">
<option value="all">ToÈ›i</option>
</select>
</label>
</div>
</header>
<!-- TAB-uri: Dashboard / Alerte LIVE / Rapoarte -->
<div class="admin-tabs">
<button class="admin-tab-btn active" data-tab="dashboard" type="button">
            ğŸ“Š Dashboard
          </button>
<button class="admin-tab-btn" data-tab="alerts" type="button">
            â° Alerte LIVE
          </button>
<a class="admin-tab-btn" href="reports.html" role="button">
            ğŸ“‘ Rapoarte
          </a>
<a class="admin-tab-btn" href="fix-day.html" role="button">
            ğŸ› ï¸ Fix Day (Editor zi)
          </a>
</div>
<div class="admin-error" id="error" style="display:none"></div>
<div class="admin-loading" id="loading">Se Ã®ncarcÄƒ datele din serverâ€¦</div>
<!-- TAB PRINCIPAL: Dashboard -->
<section id="dashboard" style="display:none">
<!-- KPI-uri principale -->
<div class="admin-kpis">
<div class="card kpi">
<div class="kpi-label">Pontaje Ã®n filtrul curent</div>
<div class="kpi-value" id="kpiTotal">â€“</div>
</div>
<div class="card kpi">
<div class="kpi-label">AngajaÈ›i implicaÈ›i</div>
<div class="kpi-value" id="kpiEmployees">â€“</div>
</div>
<div class="card kpi">
<div class="kpi-label">START</div>
<div class="kpi-value" id="kpiStart">â€“</div>
</div>
<div class="card kpi">
<div class="kpi-label">FINISH</div>
<div class="kpi-value" id="kpiFinish">â€“</div>
</div>
<div class="card kpi">
<div class="kpi-label">Norme complete (azi)</div>
<div class="kpi-value" id="kpiCompletedToday">â€“</div>
</div>
</div>
<div class="admin-grid">
<section class="card admin-card" data-section="dept">
<h2>DistribuÈ›ie pe departamente</h2>
<div class="admin-small-text">NumÄƒr de pontaje Ã®n perioada È™i filtrele selectate.</div>
<div class="admin-list" id="deptList"></div>
</section>
<section class="card admin-card" data-section="dept">
<h2 id="lastEventsTitle">Ultimele pontaje</h2>
<div class="admin-small-text" id="lastEventsHint">
<span>PerioadÄƒ listÄƒ:</span>
<select id="lastEventsRange">
<option value="today">Ziua curentÄƒ</option>
<option value="week">SÄƒptÄƒmÃ¢na curentÄƒ</option>
<option value="month">Luna curentÄƒ</option>
<option value="all">Toate Ã®nregistrÄƒrile</option>
</select>
<span id="lastEventsHintText">
                  Toate Ã®nregistrÄƒrile din perioada aleasÄƒ, dupÄƒ filtrele de mai sus.
                </span>
</div>
<div class="table-wrap">
<table class="admin-table">
<thead>
<tr>
<th>Data / ora</th>
<th>Angajat</th>
<th>Departament</th>
<th>AcÈ›iune</th>
<th>Activitate</th>
</tr>
</thead>
<tbody id="lastEventsBody"></tbody>
</table>
</div>
</section>
</div>
<!-- A3: Zile incomplete -->
<section class="card admin-card" data-section="incomplete">
<h2>Zile incomplete</h2>
<div class="admin-small-text">
              Zile Ã®n care existÄƒ probleme de Ã®nchidere: START fÄƒrÄƒ FINISH, PAUSE fÄƒrÄƒ UNPAUSE, EXTRA START fÄƒrÄƒ EXTRA FINISH sau sesiune rÄƒmasÄƒ deschisÄƒ (dupÄƒ filtrul curent).
            </div>
<div style="margin:6px 0 10px;display:flex;gap:6px;flex-wrap:wrap;">
<button class="top-toggle active" id="incompleteDayAllBtn" type="button">Toate</button>
<button class="top-toggle" id="incompleteDayWeekendBtn" type="button">Doar weekend</button>
<button class="top-toggle" id="incompleteDayWorkBtn" type="button">Doar zile lucrÄƒtoare</button>
</div>
<div class="table-wrap">
<table class="admin-table">
<thead>
<tr>
<th>Data</th>
<th>Angajat</th>
<th>Departament</th>
<th>NormÄƒ</th>
<th>Extra</th>
<th>Stare</th>
</tr>
</thead>
<tbody id="incompleteDaysBody"></tbody>
</table>
</div>
</section>
<!-- A3: Anomalii -->
<section class="card admin-card" data-section="anomalies">
<h2>Anomalii pontaj</h2>
<div class="admin-small-text">
              Zile cu posibile probleme de pontaj: pauze neÃ®nchise, EXTRA neÃ®nchis, pauze prea lungi, ore foarte multe sau pontaj Ã®n weekend.
            </div>
<div style="margin:6px 0 10px;display:flex;gap:6px;flex-wrap:wrap;">
<button class="top-toggle active" id="anomalyDayAllBtn" type="button">Toate</button>
<button class="top-toggle" id="anomalyDayWeekendBtn" type="button">Doar weekend</button>
<button class="top-toggle" id="anomalyDayWorkBtn" type="button">Doar zile lucrÄƒtoare</button>
</div>
<div class="table-wrap">
<table class="admin-table">
<thead>
<tr>
<th>Data</th>
<th>Angajat</th>
<th>Departament</th>
<th>NormÄƒ</th>
<th>Extra</th>
<th>Detalii</th>
</tr>
</thead>
<tbody id="anomaliesBody"></tbody>
</table>
</div>
</section>
<!-- Log brut -->
<section class="card admin-card" data-section="rawlog">
<h2 id="rawLogTitle">Log brut (filtru curent)</h2>
<div class="admin-small-text">
              Lista completÄƒ a evenimentelor care trec de filtrele de mai sus â€” utilÄƒ pentru debugging sau verificÄƒri rapide.
            </div>
<pre class="admin-log" id="rawLog">â€“</pre>
</section>
<!-- A3: PrezenÈ›Äƒ pe zile -->
<section class="card admin-card" data-section="daily">
<h2>PrezenÈ›Äƒ pe zile</h2>
<div class="admin-small-text">
              Pentru perioada È™i filtrele de mai sus: cÃ¢È›i angajaÈ›i au avut cel puÈ›in un START, cÃ¢È›i au normÄƒ completÄƒ È™i cÃ¢È›i sunt Ã®n concediu.
            </div>
<div class="table-wrap">
<table class="admin-table">
<thead>
<tr>
<th>Data</th>
<th>AngajaÈ›i cu pontaj</th>
<th>NormÄƒ completÄƒ</th>
<th>% complet</th>
<th>Concedii aprobate</th>
</tr>
</thead>
<tbody id="dailyPresenceBody"></tbody>
</table>
</div>
</section>
<!-- A4: Calendar prezenÈ›Äƒ -->
<section class="card admin-card" data-section="calendar">
<h2>Calendar prezenÈ›Äƒ (lunÄƒ curentÄƒ)</h2>
<div class="admin-small-text">
              Fiecare zi aratÄƒ cÃ¢È›i angajaÈ›i au avut pontaj È™i cÃ¢È›i au normÄƒ completÄƒ, pentru luna curentÄƒ. Click pe o zi pentru a filtra mai jos.
            </div>
<div style="margin:6px 0 10px;display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap;">
<button class="top-toggle" id="calPrevBtn" type="button">â€¹ Luna anterioarÄƒ</button>
<div class="chip" id="calendarMonthLabel">â€“</div>
<button class="top-toggle" id="calNextBtn" type="button">Luna urmÄƒtoare â€º</button>
</div>
<div class="calendar-grid" id="presenceCalendar"></div>
<div class="calendar-legend">
<span class="calendar-legend-label">LegendÄƒ:</span>
<span class="calendar-legend-item">
<span class="calendar-legend-box calendar-legend-nodata"></span> fÄƒrÄƒ pontaj
              </span>
<span class="calendar-legend-item">
<span class="calendar-legend-box calendar-legend-low"></span> &lt;50% complet
              </span>
<span class="calendar-legend-item">
<span class="calendar-legend-box calendar-legend-med"></span> 50â€“90% complet
              </span>
<span class="calendar-legend-item">
<span class="calendar-legend-box calendar-legend-high"></span> &gt;90% complet
              </span>
</div>
<div id="calendarDayDetails" style="display:none;margin-top:12px;">
<div class="admin-small-text">
<b>Zi selectatÄƒ:</b> <span id="calendarSelectedDayLabel">â€“</span>
</div>
<div style="margin:6px 0 6px;font-weight:700;font-size:12px;color:var(--muted);">
    Inactivi (fÄƒrÄƒ pontaj)
  </div>
<div class="admin-list" id="calendarInactiveList"></div>
</div>
</section>
<!-- A2: Index & detalii angajat -->
<div class="admin-grid">
<section class="card admin-card" data-section="employees">
<h2>Index angajaÈ›i</h2>
<div class="admin-small-text">
                ListÄƒ angajaÈ›i (dupÄƒ filtrul de departament). Click pe un nume pentru a vedea statistici detaliate (all time).
              </div>
<div class="admin-filter-line" style="margin:8px 0 6px;">
<label style="flex:1;">
<span>CautÄƒ angajat / departament</span>
<input id="employeeSearch" placeholder="TasteazÄƒ pentru a filtra..." type="text"/>
</label>
</div>
<div class="admin-list" id="employeeIndexList"></div>
</section>
<section class="card admin-card" data-section="employees">
<h2>Detalii angajat</h2>
<div class="admin-small-text" id="employeeDetailsHeader">
                SelecteazÄƒ un angajat din listÄƒ pentru a vedea situaÈ›ia pe toate zilele (normÄƒ, extra, overtime, zile complete, concediu).
              </div>
<a class="btn" href="#" id="employeeSelfLink" rel="noopener" style="display:none;margin:8px 0 10px" target="_blank">
  ğŸ§¾ Deschide pontajul angajatului
</a>
<div id="employeeDetailsBody">
<div class="admin-empty">Niciun angajat selectat.</div>
</div>
</section>
</div>
</section>
<!-- TAB NOU: Alerte LIVE -->
<section id="alertsPage" style="display:none">
<div class="admin-filter-line" style="margin:0 0 10px;">
<label>
<span>Tip alertÄƒ</span>
<select id="alertsTypeFilter">
<option value="all">Toate</option>
<option value="pause">PauzÄƒ</option>
<option value="norm">NormÄƒ</option>
<option value="extra">Extra</option>
<option value="system">Sistem</option>
</select>
</label>
<label>
<span>Departament</span>
<select id="alertsDeptFilter">
<option value="all">Toate</option>
</select>
</label>
<label style="flex:1;min-width:220px;">
<span>CautÄƒ</span>
<input id="alertsSearch" placeholder="Nume / mesaj..." type="text"/>
</label>
</div>
<section class="card admin-card" data-section="alerts">
<h2>Alerte LIVE pe ziua curentÄƒ</h2>
<div class="admin-small-text">
              Monitorizare Ã®n timp real (client-side) pentru:
              <ul style="margin:4px 0 0 16px;padding:0;font-size:11px;color:var(--muted);">
<li>PauzÄƒ &gt; limitÄƒ (implicit 40 min, din configurare) fÄƒrÄƒ UNPAUSE â€“ notificÄƒri din 15 Ã®n 15 minute.</li>
<li>NormÄƒ depÄƒÈ™itÄƒ (8h / 8h30 sau valori din <code>normSettings</code>) fÄƒrÄƒ FINISH â€“ notificÄƒri din 30 Ã®n 30 de minute.</li>
<li>EXTRA Ã®n curs &gt; 30 min â€“ notificÄƒri din 15 Ã®n 15 minute.</li>
</ul>
</div>
<div class="admin-list" id="liveAlertsActive"></div>
</section>
<section class="card admin-card" data-section="alerts">
<h2>Istoric notificÄƒri Ã®n sesiunea curentÄƒ</h2>
<div class="admin-small-text">
              Fiecare depÄƒÈ™ire genereazÄƒ o notificare iniÈ›ialÄƒ, apoi Ã®ncÄƒ una la fiecare interval (15 / 30 min) cÃ¢t timp condiÈ›ia rÄƒmÃ¢ne activÄƒ.
              Istoricul este local, doar pentru sesiunea curentÄƒ a paginii.
            </div>
<div class="table-wrap">
<table class="admin-table">
<thead>
<tr>
<th>Moment</th>
<th>Angajat</th>
<th>Departament</th>
<th>Tip</th>
<th>Mesaj</th>
</tr>
</thead>
<tbody id="liveAlertsHistoryBody"></tbody>
</table>
</div>
</section>
<!-- NOU: Alerte istorice din sistem (toate zilele anterioare) -->
<section class="card admin-card" data-section="alerts">
<h2>Alerte istorice din sistem</h2>
<div class="admin-small-text">
              Alerte generate de Apps Script pentru toate zilele (inclusiv cele anterioare), pe baza datelor salvate Ã®n foaia de pontaj.
            </div>
<div class="table-wrap">
<table class="admin-table">
<thead>
<tr>
<th>Moment</th>
<th>Angajat</th>
<th>Departament</th>
<th>Tip</th>
<th>Mesaj</th>
</tr>
</thead>
<tbody id="systemAlertsHistoryBody"></tbody>
</table>
</div>
</section>
</section>
</section>
<aside class="admin-side">
<!-- A2: Top angajaÈ›i (pliabil) -->
<section class="card admin-card collapsible" data-section="live">
<h2 class="admin-card-title">
            Top angajaÈ›i
            <span class="collapse-icon">â–¼</span>
</h2>
<div class="admin-card-body">
<div class="admin-small-text">
              Clasament all time:
              <button class="top-toggle active" id="topModeHours" type="button">Ore normÄƒ</button>
<button class="top-toggle" id="topModeAnomalies" type="button">Anomalii</button>
</div>
<div class="admin-list" id="topEmployees"></div>
</div>
</section>
<!-- A5: Live board (pliabil) -->
<section class="card admin-card collapsible" data-section="live">
<h2 class="admin-card-title">
            Live pontaj
            <span class="collapse-icon">â–¼</span>
</h2>
<div class="admin-card-body">
<div class="admin-small-text" id="liveBoardHint">
<div class="admin-small-text" id="liveBoardSummary" style="margin:6px 0 8px;"></div>
<span id="liveBoardHintText">
                Starea curentÄƒ a pontajului pentru ziua de azi (START / PAUSE / EXTRA / FINISH).
              </span>
</div>
<div style="margin:6px 0 8px;display:flex;gap:6px;flex-wrap:wrap;">
<button class="top-toggle active" id="liveBoardTodayBtn" type="button">Azi</button>
<button class="top-toggle" id="liveBoardPastBtn" type="button">Zile anterioare</button>
</div>
<div style="margin:10px 0 6px;display:flex;align-items:center;justify-content:space-between;gap:8px;">
<div class="admin-small-text" style="margin:0;font-weight:700;">AngajaÈ›i (status)</div>
<!-- (opÈ›ional) poÈ›i pune aici un badge count dacÄƒ vrei -->
</div>
<div class="admin-list" id="liveBoard"></div>
<div style="margin:10px 0 6px;display:flex;align-items:center;justify-content:space-between;gap:8px;">
<div class="admin-small-text" style="margin:0;font-weight:700;">Inactivi azi</div>
<span class="badge badge-info" id="liveInactiveCount" style="display:none"></span>
</div>
<div class="admin-list" id="liveBoardInactive"></div>
</div>
</section>
<!-- A5.5. Admin presence (cine e online) -->
<section class="card" id="adminPresenceCard">
<div class="card-head">
<h3>Admini activi</h3>
<div class="muted" id="adminPresenceHint">â€”</div>
</div>
<div class="card-body">
<div class="pres-list" id="adminPresenceList"></div>
</div>
</section>
<!-- A6: Alerte sistem (pliabil) -->
<section class="card admin-card collapsible" data-section="live">
<h2 class="admin-card-title">
            Alerte sistem
            <span class="collapse-icon">â–¼</span>
</h2>
<div class="admin-card-body">
<div class="admin-small-text">
              Ultimele notificÄƒri generate de sistem (pontaj uitat, anomalii etc.), venite din Apps Script.
            </div>
<div class="admin-list" id="alertsList"></div>
</div>
</section>
<!-- NotiÈ›e (pliabil) -->
<section class="card admin-card collapsible" data-section="live">
<h2 class="admin-card-title">
            NotiÈ›e
            <span class="collapse-icon">â–¼</span>
</h2>
<div class="admin-card-body">
<p class="admin-small-text">
              Pagina citeÈ™te datele prin Apps Script (<code>adminEventsEndpoint</code> din <code>config.json</code>).
              Foaia de pontaj rÄƒmÃ¢ne privatÄƒ; serverul Ã®ntoarce un JSON cu evenimente, concedii È™i meta (alerte, versiune),
              iar aici calculÄƒm statistici, ore pe zi, overtime È™i rapoarte PDF/CSV.
            </p>
</div>
</section>
</aside>
</main>
</div>
<script>(function(){try{const t=document.body.getAttribute('data-page-title')||'Admin';document.title=t;}catch(e){}})();</script><script src="admin-core.js"></script></body>
</html>
